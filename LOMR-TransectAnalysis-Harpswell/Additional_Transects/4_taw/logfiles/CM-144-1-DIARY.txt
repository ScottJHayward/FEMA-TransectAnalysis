diary on         % begin recording

% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%

%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   

gamma_berm=1;   % this may get changed automatically below
gamma_rough=1;  
gamma_beta=1;  
gamma_perm=1;

setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 

plotTitle='Iterative TAW for CM-144-1'

plotTitle =

Iterative TAW for CM-144-1



% END CONFIG
%-------------------------------

SWEL=SWEL+setupAtToe  

SWEL =

                  8.736223

SWEL_fore=SWEL+maxSetup

SWEL_fore =

                 10.255623



% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2

L0 =

          417.357062285715


% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking

% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0

Ztoe =

                 -2.595977


% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);

% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];

sta_org=sta;  % used for plotting purposes
dep_org=dep;


% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0

Z2 =

                 20.068423


% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end

toe_sta =

         -62.4868075374234


toe_sta =

         -38.3813446313046


top_sta =

          34.9443976794092

% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end

% just so the reader can tell the values aren't -999 anymore
top_sta

top_sta =

          34.9443976794092

toe_sta

toe_sta =

         -38.3813446313046




% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end

ans =

-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope


ans =

-!!- Setup is interpolated between setup at toe of slope and max setup


ans =

-!!-       setup is adjusted to 0.45 feet


ans =

-!!-       SWEL is adjusted to 9.26 feet


k =

     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32




% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta

    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough

    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end


    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.977861924974634
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.4035594084022
R2del =
         0.739159408402184
Z2 =
           32.659493910529
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          112.060463877013
Z2 =
           32.659493910529
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.4035594084022
Z2 =
           32.659493910529
top_sta =
          112.060463877013
Lslope =
          150.441808508318
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.113000502776195
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978600551028116
slope =
         0.264201087385079
Irb =
          1.96370840192932
gamma_berm =
         0.978600551028116
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978600551028116
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3491540099791
R2del =
        0.0544053984230999
Z2 =
          32.6050885121059
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          111.691012577114
Z2 =
          32.6050885121059
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.3491540099791
Z2 =
          32.6050885121059
top_sta =
          111.691012577114
Lslope =
          150.072357208419
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.113278689801551
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978547869412482
slope =
         0.264525753135745
Irb =
          1.96612152168106
gamma_berm =
         0.978547869412482
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978547869412482
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3530785745975
R2del =
       0.00392456461842983
Z2 =
          32.6090130767243
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          32.6090130767243
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.977861924974634
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.4035594084022
R2del =
         0.739159408402184
Z2 =
           32.659493910529
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          112.060463877013
Z2 =
           32.659493910529
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.4035594084022
Z2 =
           32.659493910529
top_sta =
          112.060463877013
Lslope =
          150.441808508318
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.113000502776195
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978600551028116
slope =
         0.264201087385079
Irb =
          1.96370840192932
gamma_berm =
         0.978600551028116
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978600551028116
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3491540099791
R2del =
        0.0544053984230999
Z2 =
          32.6050885121059
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          111.691012577114
Z2 =
          32.6050885121059
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.3491540099791
Z2 =
          32.6050885121059
top_sta =
          111.691012577114
Lslope =
          150.072357208419
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.113278689801551
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978547869412482
slope =
         0.264525753135745
Irb =
          1.96612152168106
gamma_berm =
         0.978547869412482
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978547869412482
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3530785745975
R2del =
       0.00392456461842983
Z2 =
          32.6090130767243
Z2 =
          32.6090130767243
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=1;   % this may get changed automatically below
gamma_rough=1;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.977861924974634
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.4035594084022
R2del =
         0.739159408402184
Z2 =
           32.659493910529
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          112.060463877013
Z2 =
           32.659493910529
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.4035594084022
Z2 =
           32.659493910529
top_sta =
          112.060463877013
Lslope =
          150.441808508318
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.113000502776195
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978600551028116
slope =
         0.264201087385079
Irb =
          1.96370840192932
gamma_berm =
         0.978600551028116
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978600551028116
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3491540099791
R2del =
        0.0544053984230999
Z2 =
          32.6050885121059
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          111.691012577114
Z2 =
          32.6050885121059
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.3491540099791
Z2 =
          32.6050885121059
top_sta =
          111.691012577114
Lslope =
          150.072357208419
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.113278689801551
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978547869412482
slope =
         0.264525753135745
Irb =
          1.96612152168106
gamma_berm =
         0.978547869412482
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978547869412482
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3530785745975
R2del =
       0.00392456461842983
Z2 =
          32.6090130767243
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          32.6090130767243
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=1;   % this may get changed automatically below
gamma_rough=1;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.977861924974634
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.4035594084022
R2del =
         0.739159408402184
Z2 =
           32.659493910529
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          112.060463877013
Z2 =
           32.659493910529
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.4035594084022
Z2 =
           32.659493910529
top_sta =
          112.060463877013
Lslope =
          150.441808508318
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.113000502776195
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978600551028116
slope =
         0.264201087385079
Irb =
          1.96370840192932
gamma_berm =
         0.978600551028116
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978600551028116
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3491540099791
R2del =
        0.0544053984230999
Z2 =
          32.6050885121059
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          111.691012577114
Z2 =
          32.6050885121059
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          23.3491540099791
Z2 =
          32.6050885121059
top_sta =
          111.691012577114
Lslope =
          150.072357208419
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.113278689801551
rdh_mean =
         0.810625187975784
gamma_berm =
         0.978547869412482
slope =
         0.264525753135745
Irb =
          1.96612152168106
gamma_berm =
         0.978547869412482
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
     1
gamma =
         0.978547869412482
ans =
!!! - - Iribaren number:   1.92 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.8 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          23.3530785745975
R2del =
       0.00392456461842983
Z2 =
          32.6090130767243
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          32.6090130767243
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.97855;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.8;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.782289539979707
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.7228475267218
R2del =
          3.94155247327825
Z2 =
          27.9787820288486
top_sta =
          79.8990878658385
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          79.8990878658385
Z2 =
          27.9787820288486
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          18.7228475267218
Z2 =
          27.9787820288486
top_sta =
          79.8990878658385
Lslope =
          118.280432497143
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.143726224541922
rdh_mean =
         0.810625187975784
gamma_berm =
         0.972781873244423
slope =
         0.301882192591457
Irb =
          2.24377803987103
gamma_berm =
         0.972781873244423
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778225498595539
ans =
!!! - - Iribaren number:   2.18 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          19.0011704443444
R2del =
          0.27832291762261
Z2 =
          28.2571049464712
top_sta =
          81.8553611847108
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          81.8553611847108
Z2 =
          28.2571049464712
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          19.0011704443444
Z2 =
          28.2571049464712
top_sta =
          81.8553611847108
Lslope =
          120.236705816015
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
          0.14138777243293
rdh_mean =
         0.810625187975784
gamma_berm =
         0.973224717172991
slope =
         0.298857675693918
Irb =
          2.22129793086672
gamma_berm =
         0.973224717172991
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778579773738393
ans =
!!! - - Iribaren number:   2.16 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.9781084739222
R2del =
        0.0230619704221695
Z2 =
           28.234042976049
top_sta =
          81.6932634393908
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          81.6932634393908
Z2 =
           28.234042976049
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          18.9781084739222
Z2 =
           28.234042976049
top_sta =
          81.6932634393908
Lslope =
          120.074608070695
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.141578642421977
rdh_mean =
         0.810625187975784
gamma_berm =
         0.973188571204694
slope =
         0.299103926302623
Irb =
          2.22312822003805
gamma_berm =
         0.973188571204694
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778550856963756
ans =
!!! - - Iribaren number:   2.16 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.9800034263996
R2del =
        0.0018949524774321
Z2 =
          28.2359379285264
top_sta =
          81.7065826622698
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          28.2359379285264
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.782289539979707
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.7228475267218
R2del =
          3.94155247327825
Z2 =
          27.9787820288486
top_sta =
          79.8990878658385
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          79.8990878658385
Z2 =
          27.9787820288486
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          18.7228475267218
Z2 =
          27.9787820288486
top_sta =
          79.8990878658385
Lslope =
          118.280432497143
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.143726224541922
rdh_mean =
         0.810625187975784
gamma_berm =
         0.972781873244423
slope =
         0.301882192591457
Irb =
          2.24377803987103
gamma_berm =
         0.972781873244423
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778225498595539
ans =
!!! - - Iribaren number:   2.18 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          19.0011704443444
R2del =
          0.27832291762261
Z2 =
          28.2571049464712
top_sta =
          81.8553611847108
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          81.8553611847108
Z2 =
          28.2571049464712
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          19.0011704443444
Z2 =
          28.2571049464712
top_sta =
          81.8553611847108
Lslope =
          120.236705816015
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
          0.14138777243293
rdh_mean =
         0.810625187975784
gamma_berm =
         0.973224717172991
slope =
         0.298857675693918
Irb =
          2.22129793086672
gamma_berm =
         0.973224717172991
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778579773738393
ans =
!!! - - Iribaren number:   2.16 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.9781084739222
R2del =
        0.0230619704221695
Z2 =
           28.234042976049
top_sta =
          81.6932634393908
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          81.6932634393908
Z2 =
           28.234042976049
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          18.9781084739222
Z2 =
           28.234042976049
top_sta =
          81.6932634393908
Lslope =
          120.074608070695
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.141578642421977
rdh_mean =
         0.810625187975784
gamma_berm =
         0.973188571204694
slope =
         0.299103926302623
Irb =
          2.22312822003805
gamma_berm =
         0.973188571204694
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.8
gamma =
         0.778550856963756
ans =
!!! - - Iribaren number:   2.16 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.3 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          18.9800034263996
R2del =
        0.0018949524774321
Z2 =
          28.2359379285264
top_sta =
          81.7065826622698
Z2 =
          28.2359379285264
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
plotTitle =
Iterative TAW for CM-144-1
SWEL =
                  8.736223
SWEL_fore =
                 10.255623
L0 =
          417.357062285715
Ztoe =
                 -2.595977
Z2 =
                 20.068423
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
top_sta =
          34.9443976794092
toe_sta =
         -38.3813446313046
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
Z2 =
          23.8092710365979
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
diary on         % begin recording
% FEMA appeal for The Town of Harpswell, Cumberland county, Maine
% TRANSECT ID: CM-144-1
% calculation by SJH, Ransom Consulting, Inc. 26-Feb-2020
% 100-year wave runup using TAW methodology
% including berm and weighted average with foreshore if necessary
%
% chk nld 20200220
%
% This script assumes that the incident wave conditions provided
% as input in the configuration section below are the 
% appropriate values located at the end of the foreshore
% or toe of the slope on which the run-up is being calculated
% the script does not attempt to apply a depth limit or any other
% transformation to the incident wave conditions other than 
% conversion of the peak wave period to the spectral mean wave 
% as recommended in the references below
% 
% references:
%
% Van der Meer, J.W., 2002. Technical Report Wave Run-up and 
% Wave Overtopping at Dikes. TAW Technical Advisory Committee on
% Flood Defence, The Netherlands.
%
% FEMA. 2007,  Atlantic Ocean and Gulf of Mexico Coastal Guidelines Update
%
% 
%
%--------------------------------------------------------------------------
% CONFIG
%--------------------------------------------------------------------------
fname='inpfiles/CM-144-1sta_ele_include.csv';   % file with station, elevation, include
                                      % third colunm is 0 for excluded points
imgname='logfiles/CM-144-1-runup';                            
SWEL=8.8043;  % 100-yr still water level including wave setup. 
H0=7.5548;    % significant wave height at toe of structure 
Tp=9.9345;    % peak period, 1/fma, 
T0=Tp/1.1;   
gamma_berm=0.96381;   % this may get changed automatically below
gamma_rough=0.6;  
gamma_beta=1;  
gamma_perm=1;
setupAtToe=-0.068077; 
maxSetup=1.5194;   % only used in case of berm/shallow foreshore weighted average 
plotTitle='Iterative TAW for CM-144-1'
plotTitle =
Iterative TAW for CM-144-1
% END CONFIG
%-------------------------------
SWEL=SWEL+setupAtToe  
SWEL =
                  8.736223
SWEL_fore=SWEL+maxSetup
SWEL_fore =
                 10.255623
% FIND WAVELENGTH USING DEEPWATER DISPERSION RELATION
% using English units
L0=32.15/(2*pi)*T0^2
L0 =
          417.357062285715
% Find Hb (Munk, 1949)
%Hb=H0/(3.3*(H0/L0)^(1/3)) 
%Db=-Hb/.78+SWEL;  % depth at breaking
% The toe elevation here is only used to determine the average 
% structure slope, it is not used to depth limit the wave height.
% Any depth limiting or other modification of the wave height 
% to make it consitent with TAW guidance should be performed 
% prior to the input of the significant wave height given above. 
Ztoe=SWEL-1.5*H0
Ztoe =
                 -2.595977
% read the transect
[sta,dep,inc] = textread(fname,'%n%n%n%*[^\n]','delimiter',',','headerlines',0);
% remove unselected points
k=find(inc==0);
sta(k)=[];
dep(k)=[];
sta_org=sta;  % used for plotting purposes
dep_org=dep;
% initial guess at maximum run-up elevation to estimate slope
Z2=SWEL+1.5*H0
Z2 =
                 20.068423
% determine station at the max runup and -1.5*H0 (i.e. the toe)
top_sta=-999;
toe_sta=-999;
for kk=1:length(sta)-1
    if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
       top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
    end
    if  ((Ztoe > dep(kk)) & (Ztoe <= dep(kk+1)))    % here is the intersection of Ztoe with profile
       toe_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Ztoe)
    end
end
toe_sta =
         -62.4868075374234
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
% check to make sure we got them, if not extend the end slopes outward
S=diff(dep)./diff(sta);
if toe_sta==-999
   dy=dep(1)-Ztoe;
   toe_sta=sta(1)-dy/S(1)
end
if top_sta==-999
   dy=Z2-dep(end);
   top_sta=sta(end)+dy/S(end)
end
% just so the reader can tell the values aren't -999 anymore
top_sta
top_sta =
          34.9443976794092
toe_sta
toe_sta =
         -38.3813446313046
% check for case where the toe of slope is below SWL-1.5*H0
% in this case interpolate setup from the setupAtToe(really setup as first station), and the max setup
% also un-include points seaward of SWL-1.5*H0
if Ztoe > dep(1)
   dd=SWEL_fore-dep;
   k=find(dd<0,1); % k is index of first land point
   staAtSWL=interp1(dep(k-1:k),sta(k-1:k),SWEL_fore);   
   dsta=staAtSWL-sta(1);
   dsetup=maxSetup-setupAtToe;
   dsetdsta=dsetup/dsta;
   setup=setupAtToe+dsetdsta*(toe_sta-sta(1));
   sprintf('-!!- Location of SWEL-1.5*H0 is %4.1f ft landward of toe of slope',dsta)
   sprintf('-!!- Setup is interpolated between setup at toe of slope and max setup')
   sprintf('-!!-       setup is adjusted to %4.2f feet',setup)
   SWEL=SWEL-setupAtToe+setup;
   sprintf('-!!-       SWEL is adjusted to %4.2f feet',SWEL)
   k=find(dep < SWEL-1.5*H0)
   sta(k)=[];
   dep(k)=[];
else
   sprintf('-!!- The User has selected a starting point that is %4.2f feet above the elevation of SWEL-1.5H0\n',dep(1)-Ztoe)
   sprintf('-!!- This may be reasonable for some cases.  However the user may want to consider:\n')
   sprintf('-!!-   1) Selecting a starting point that is at or below %4.2f feet elevation, or\n', Ztoe)
   sprintf('-!!-   2) Reducing the incident wave height to a depth limited condition.\n')
end
ans =
-!!- Location of SWEL-1.5*H0 is 84.4 ft landward of toe of slope
ans =
-!!- Setup is interpolated between setup at toe of slope and max setup
ans =
-!!-       setup is adjusted to 0.45 feet
ans =
-!!-       SWEL is adjusted to 9.26 feet
k =
     1
     2
     3
     4
     5
     6
     7
    24
    25
    26
    27
    28
    29
    30
    31
    32
% now iterate converge on a runup elevation
tol=0.01;  % convergence criteria
R2del=999;
R2_new=3*H0; %initial guess
R2=R2_new;
iter=0;
R2_all=[];
topStaAll=[];
Berm_Segs=[];
TAW_ALWAYS_VALID=1;
while(abs(R2del) > tol && iter <= 25)
    iter=iter+1;
    sprintf ('!----------------- STARTING ITERATION %d -----------------!',iter)
    % elevation of toe of slope
    Ztoe
    % station of toe slope (relative to 0-NAVD88 shoreline
    toe_sta 
    % station of top of slope/extent of 2% run-up
    top_sta
    % elevation of top of slope/extent of 2% run-up
    Z2
    % incident significant wave height
    H0
    % incident spectral peak wave period
    Tp
    % incident spectral mean wave period
    T0
        
    R2=R2_new  
    Z2=R2+SWEL
    % determine slope for this iteration
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end)
    end
    
    % get the length of the slope (not accounting for berm)
    Lslope=top_sta-toe_sta
    % loop over profile segments to determine berm factor 
    % re-calculate influence of depth of berm based on this run-up elevation
    % check for berm, berm width, berm height
    berm_width=0;
    rdh_sum=0;
    Berm_Segs=[];
    Berm_Heights=[];
    for kk=1:length(sta)-1
       ddep=dep(kk+1)-dep(kk);
       dsta=sta(kk+1)-sta(kk);
       s=ddep/dsta;
       if  (s < 1/15)     % count it as a berm if slope is flatter than 1:15 (see TAW manual)
          sprintf ('Berm Factor Calculation: Iteration %d, Profile Segment: %d',iter,kk) 
          berm_width=berm_width+dsta;   % tally the width of all berm segments
          % compute the rdh for this segment and weight it by the segment length
          dh=SWEL-(dep(kk)+dep(kk+1))/2  
          if  dh < 0
              chi=R2;
          else 
              chi=2* H0;
          end
          if (dh <= R2 & dh >=-2*H0)
             rdh=(0.5-0.5*cos(3.14159*dh/chi)) ;
          else
             rdh=1;
          end
          rdh_sum=rdh_sum + rdh * dsta
          Berm_Segs=[Berm_Segs, kk];
          Berm_Heights=[Berm_Heights, (dep(kk)+dep(kk+1))/2];
       end
       if dep(kk) >= Z2  % jump out of loop if we reached limit of run-up for this iteration 
          break
       end
    end
    sprintf ('!------- End Berm Factor Calculation, Iter: %d ---------!',iter)
    berm_width
    rB=berm_width/Lslope 
    if (berm_width > 0)
       rdh_mean=rdh_sum/berm_width
    else
       rdh_mean=1
    end
    gamma_berm=1- rB * (1-rdh_mean)
    if gamma_berm > 1
       gamma_berm=1
    end
    if gamma_berm < 0.6
       gamma_berm =0.6
    end
    % Iribarren number
    slope=(Z2-Ztoe)/(Lslope-berm_width)
    Irb=(slope/(sqrt(H0/L0)))
    % runup height
    gamma_berm
    gamma_perm
    gamma_beta
    gamma_rough
    gamma=gamma_berm*gamma_perm*gamma_beta*gamma_rough
    % check validity
    TAW_VALID=1;
    if (Irb*gamma_berm < 0.5 | Irb*gamma_berm > 10 )
       sprintf('!!! - - Iribaren number: %6.2f is outside the valid range (0.5-10), TAW NOT VALID - - !!!\n', Irb*gamma_berm)
       TAW_VALID=0;
    else
       sprintf('!!! - - Iribaren number: %6.2f is in the valid range (0.5-10), TAW RECOMMENDED - - !!!\n', Irb*gamma_berm)
    end
    islope=1/slope;  
    if (slope < 1/8 | slope > 1)
       sprintf('!!! - - slope: 1:%3.1f V:H is outside the valid range (1:8 - 1:1), TAW NOT VALID - - !!!\n', islope)
       TAW_VALID=0;
    else
       sprintf('!!! - - slope: 1:%3.1f V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!\n', islope)
    end
    if TAW_VALID == 0
       TAW_ALWAYS_VALID=0;
    end
         
    if (Irb*gamma_berm < 1.8)
       R2_new=gamma*H0*1.77*Irb
    else
       R2_new=gamma*H0*(4.3-(1.6/sqrt(Irb))) 
    end
    % check to see if we need to evaluate a shallow foreshore
    if berm_width > 0.25 * L0;
       disp ('!   Berm_width is greater than 1/4 wave length')
       disp ('!   Runup will be weighted average with foreshore calculation assuming depth limited wave height on berm');
       % do the foreshore calculation 
       fore_H0=0.78*(SWEL_fore-min(Berm_Heights))
       % get upper slope
       fore_toe_sta=-999;
       fore_toe_dep=-999;
       for kk=length(dep)-1:-1:1
          ddep=dep(kk+1)-dep(kk);
          dsta=sta(kk+1)-sta(kk);
          s=ddep/dsta;
          if s < 1/15
             break
          end
          fore_toe_sta=sta(kk);
          fore_toe_dep=dep(kk);
          upper_slope=(Z2-fore_toe_dep)/(top_sta-fore_toe_sta)
       end
       fore_Irb=upper_slope/(sqrt(fore_H0/L0));
       fore_gamma=gamma_perm*gamma_beta*gamma_rough;
       if (fore_Irb < 1.8)
          fore_R2=fore_gamma*fore_H0*1.77*fore_Irb;
       else
          fore_R2=fore_gamma*fore_H0*(4.3-(1.6/sqrt(fore_Irb))); 
       end
       if berm_width >= L0
          R2_new=fore_R2
          disp ('berm is wider than one wavelength, use full shallow foreshore solution');
       else
          w2=(berm_width-0.25*L0)/(0.75*L0)
          w1=1-w2
          R2_new=w2*fore_R2 + w1*R2_new
       end
    end % end berm width check
    % convergence criterion
    R2del=abs(R2-R2_new)
    R2_all(iter)=R2_new;
    % get the new top station (for plot purposes)
    Z2=R2_new+SWEL
    top_sta=-999;
    for kk=1:length(sta)-1
       if ((Z2 > dep(kk)) & (Z2 <= dep(kk+1)))    % here is the intersection of z2 with profile
          top_sta=interp1(dep(kk:kk+1),sta(kk:kk+1),Z2)
          break;
       end
    end
    if top_sta==-999
       dy=Z2-dep(end);
       top_sta=sta(end)+dy/S(end);
    end
    topStaAll(iter)=top_sta;
end
ans =
!----------------- STARTING ITERATION 1 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          34.9443976794092
Z2 =
                 20.068423
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
                   22.6644
Z2 =
          31.9203345021268
top_sta =
          107.041046462901
Lslope =
          145.422391094205
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 1, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 1 ---------!
berm_width =
    17
rB =
         0.116900842243663
rdh_mean =
         0.810625187975784
gamma_berm =
         0.977861924974634
slope =
         0.268771755517362
Irb =
           1.9976804779061
gamma_berm =
         0.977861924974634
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
          0.58671715498478
ans =
!!! - - Iribaren number:   1.95 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:3.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.0421356450413
R2del =
          8.62226435495869
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
ans =
!----------------- STARTING ITERATION 2 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          46.9993332993712
Z2 =
          23.2980701471681
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.0421356450413
Z2 =
          23.2980701471681
top_sta =
          46.9993332993712
Lslope =
          85.3806779306758
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 2, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 2 ---------!
berm_width =
    17
rB =
         0.199108280843155
rdh_mean =
         0.810625187975784
gamma_berm =
         0.962293906742863
slope =
         0.378674911258111
Irb =
          2.81454975146854
gamma_berm =
         0.962293906742863
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.577376344045718
ans =
!!! - - Iribaren number:   2.71 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.6 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
          14.5964003534129
R2del =
         0.554264708371569
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
ans =
!----------------- STARTING ITERATION 3 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.8951497883595
Z2 =
          23.8523348555397
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
          14.5964003534129
Z2 =
          23.8523348555397
top_sta =
          50.8951497883595
Lslope =
          89.2764944196642
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 3, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 3 ---------!
berm_width =
    17
rB =
         0.190419663210427
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963939312073811
slope =
         0.365932410915933
Irb =
          2.71983948652912
gamma_berm =
         0.963939312073811
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578363587244287
ans =
!!! - - Iribaren number:   2.62 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.549424968147
R2del =
        0.0469753852659309
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
ans =
!----------------- STARTING ITERATION 4 -----------------!
Ztoe =
                 -2.595977
toe_sta =
         -38.3813446313046
top_sta =
          50.5649673529656
Z2 =
          23.8053594702738
H0 =
                    7.5548
Tp =
                    9.9345
T0 =
          9.03136363636364
R2 =
           14.549424968147
Z2 =
          23.8053594702738
top_sta =
          50.5649673529656
Lslope =
          88.9463119842703
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 9
dh =
          9.49194100212682
rdh_sum =
         0.695983762046982
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 10
dh =
          9.64669100212682
rdh_sum =
          1.40666398849417
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 11
dh =
          9.92260850212682
rdh_sum =
          2.14299703977601
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 12
dh =
          10.1985265021268
rdh_sum =
          2.90420535902459
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 13
dh =
          10.4744445021268
rdh_sum =
          3.68942949541434
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 14
dh =
          10.7503620021268
rdh_sum =
          4.49773093822128
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 15
dh =
          11.0262795021268
rdh_sum =
          5.32809529031497
ans =
Berm Factor Calculation: Iteration 4, Profile Segment: 16
dh =
          11.2205850021268
rdh_sum =
          13.7806281955883
ans =
!------- End Berm Factor Calculation, Iter: 4 ---------!
berm_width =
    17
rB =
         0.191126530383928
rdh_mean =
         0.810625187975784
gamma_berm =
         0.963805449235703
slope =
         0.366958857822288
Irb =
          2.72746868455436
gamma_berm =
         0.963805449235703
gamma_perm =
     1
gamma_beta =
     1
gamma_rough =
                       0.6
gamma =
         0.578283269541422
ans =
!!! - - Iribaren number:   2.63 is in the valid range (0.5-10), TAW RECOMMENDED - - !!!
ans =
!!! - - slope: 1:2.7 V:H is in the valid range (1:8 - 1:1), TAW RECOMMENDED - - !!!
R2_new =
           14.553336534471
R2del =
       0.00391156632409739
Z2 =
          23.8092710365979
top_sta =
          50.5924611241776
% final 2% runup elevation
Z2=R2_new+SWEL
Z2 =
          23.8092710365979
diary off
-1.000000e+00
-1.000000e+00
